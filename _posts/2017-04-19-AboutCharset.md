---
layout: post
title: "字符你不可猜"
date: 2017-04-19
excerpt: "没有乱过码的程序员，不是好文档"
tags: [字符编码, 字符集]
comments: true
---

# BOM
BOM[byte order mark]，用来标记字节序，它是unicode标准的一部分，隐藏在文件的开头告诉程序该文件是哪个unicode编码（UTF-8，UTF-16BE，UTF-16LE），并且告诉程序应该用怎样的字节序去解释文件。

## 为什么用BOM会被吐槽
上面说到BOM是为了方便程序解释文本字符编码用的。BOM是用来标记字节序的，但是utf-8的编码特殊，其实并不需要BOM来标记字节序，所以BOM对utf-8其实是无意义的，windows习惯于给utf-8文件加上BOM用来区别utf-8和ANSI编码。虽然说BOM的确是Unicode的标准，但是对于不能正确处理BOM的程序来说，BOM可能会带来各种意料不到的后果。这种隐式声明编码格式的方式在unix类系统上可能会有问题，因为unix系统的默认原则就是文件的所有内容都是可见的，BOM的内容可能会被解释出来，表现就是乱码了。而且在网络开发中，不论是html，xml还是php等等我们都会显示标注文件的编码格式，带BOM的文件反倒是容易产生一些奇怪的错误。比如html的空行，php的“锘”，div之间的间隔，乱码等等等。

> windows的笔记本应用在将文档保存为utf8编码时，会自动加上BOM

## BOM与XML
W3C定义了3条规则：
1. 文档中有BOM，就用BOM声明的编码解释文档
2. 文档中没有BOM，就用XML中的编码声明解释文档
3. 文档中没有BOM也没有明确的编码声明就用utf-8解释文档

## 为什么UTF-8不需要BOM标记字节序
UTF-8是变长的编码，字节无序，即字节储存顺序与硬件无关，可以自己解释自己。

## 字符集和字符编码
经常听说unicode，utf8，utf16，utf32，ANSI，GB，ascii等等关于字符的名词，但其实这些关键词里面其实包含了两个不同的概念，分别是字符集和字符编码，一个字符集可以对应多种字符编码，如unicode字符集，它的字符编码可以是utf8，utf16，utf32等。

### 字符集
字符集就是一些文字，标点符号，数字，图形符号的集合。常见的字符集有：ASCII，ISO 8859，GB2312, BIG5, GB18030, Unicode等。

### 字符编码
光有字符集不行，计算机在decode和encode字符的时候还需要使用相应的字符编码来实现。字符编码的作用就是将二进制映射为对应字符集的字符。

> 关于某个文档应该用什么字符编码来解释（decode），其实程序是不知道的，目前只有三种方法让程序正确的解释文档，一：通过BOM告诉程序文本的编码；二：显示声明，比如在html中我们会charset=xxx；三：我们明确的知道文档的编码类型，告诉程序该用什么字符编码解释文档

